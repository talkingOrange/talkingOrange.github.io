---
layout: post
title:  "[포스코DX|Cookie|5주] 23일차 수업"
date:   2023-09-07
categories: Java
---

# 포스코DX X 비트교육센터 6기 - Cookie

---

## mysite02 : servlet + JSP

### UserController 와 req/res


<details>
  <summary>req1 : /user?a=joinform</summary>

 
- 네비게이션의 메뉴에서 버튼 클릭시, joinform으로 넘어감.

  ```
  <li><a href="<%=request.getContextPath() %>/user?a=joinform">회원가입</a><li>
  ```
</details>


<details>
  <summary> req2 : /user?a=join</summary>

 
> 회원가입 페이지에서 정보를 입력하고, 확인을 눌렀을 때의 경로로

```html
<form id="join-form" name="joinForm" method="post" action="<%=request.getContextPath()%>/user">
<input type="hidden" name="a" value="join"> <label
						class="block-label" for="name">이름</label> <input id="name"
						name="name" type="text" value=""> <label
						class="block-label" for="email">이메일</label> <input id="email"
						name="email" type="text" value=""> <input type="button"
						value="id 중복체크"> <label class="block-label">패스워드</label> <input
						name="password" type="password" value="">

					<fieldset>
						<legend>성별</legend>
						<label>여</label> <input type="radio" name="gender" value="female"
							checked="checked"> <label>남</label> <input type="radio"
							name="gender" value="male">
					</fieldset>

					<fieldset>
						<legend>약관동의</legend>
						<input id="agree-prov" type="checkbox" name="agreeProv" value="y">
						<label>서비스 약관에 동의합니다.</label>
					</fieldset>

					<input type="submit" value="가입하기">

				</form>
```



> userController에

```
if("joinform".equals(action)) {
			request.getRequestDispatcher("/WEB-INF/views/user/joinform.jsp").forward(request, response);
		} else if("join".equals(action)) {
			String name = request.getParameter("name");
			String email = request.getParameter("email");
			String password = request.getParameter("password");
			String gender = request.getParameter("gender");
			
			//데이터 전달의 확인
			//System.out.println(name + " : " + email + " : " + password  + " : " + gender);
		
			
		}
```



> db에 user Table 추가

```sql
create table user(
 no int not null auto_increment,
 name varchar(45) not null,
 email varchar(200) not null,
 password varchar(64) not null,
 gender enum('femail', 'mail') not null,
 join_date date not null,
 
 primary key(no)
 );
```



> userVo 만들기.

> userController에 추가

```java
UserVo userVo = new UserVo();
			userVo.setName(name);
			userVo.setEmail(email);
			userVo.setPassword(password);
			userVo.setGender(gender);
			
			new UserDao().insert(userVo);
```


> userDao의 insert를 추가하기

```java
public void insert(UserVo vo) {
		Connection conn = null;
		PreparedStatement pstmt = null;
		
		try {
			conn = getConnection();
			
			String sql = "insert into user values(null, ?,?, password(?), ?, current_date())";
			pstmt = conn.prepareStatement(sql);
			
			pstmt.setString(1, vo.getName());
			pstmt.setString(2, vo.getEmail());
			pstmt.setString(3, vo.getPassword());
			pstmt.setString(4, vo.getGender());
			pstmt.setString(5, vo.getJoinDate());
			
			pstmt.executeQuery();
			
		} catch (SQLException e) {
			System.out.println("error:" + e);
		} finally {
			try {
				if(pstmt != null) {
					pstmt.close();
				}
				if(conn != null) {
					conn.close();
				}
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
	}

```

</details>



- res. redirect:/user?a=joinsuccess (join이 완료 되었다는 응답으로 이동시켜준다.)

ex. LOgin 후 메인페이지

ex. join(회원가입) 후 가입 성공 축하 페이지

> userController에서 리다이렉트 추가해주기


```java
// 앞 부분 생략
	UserVo userVo = new UserVo();
			userVo.setName(name);
			userVo.setEmail(email);
			userVo.setPassword(password);
			userVo.setGender(gender);
			
			new UserDao().insert(userVo);
			
			response.sendRedirect(request.getContextPath() + "/user?a=joinsuccess");
		}else if("joinsuccess".equals(action)) {
			request.getRequestDispatcher("/WEB-INF/views/user/joinsuccess.jsp").forward(request, response);
		}

```


> joinsuccess.html -> jsp파일로

```html
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<title>mysite</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link href="<%=request.getContextPath()%>/assets/css/user.css" rel="stylesheet" type="text/css">
</head>
<body>
	<div id="container">
		<jsp:include page="/WEB-INF/views/includes/header.jsp" />
		<div id="content">
			<div id="user">
				<p class="jr-success">
					회원가입을 축하합니다.
					<br><br>
					<a href="<%=request.getContextPath()%>/user?a=loginform">로그인하기</a>
				</p>				
			</div>
		</div>
		<jsp:include page="/WEB-INF/views/includes/navigation.jsp" />
		<jsp:include page="/WEB-INF/views/includes/footer.jsp" />
	</div>
</body>
</html>
```

- req3. /user?a=joinsuccess



