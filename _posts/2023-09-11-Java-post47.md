---
layout: post
title:  "[포스코DX|Cookie|6주] 24일차 수업"
date:   2023-09-11
categories: Java
---

# 포스코DX X 비트교육센터 6기 - 

---

### Default servlet

Default servlet은 정적 웹 리소스(HTML, CSS, 이미지 등)를 제공하기 위한 특수 서블릿으로, 컨텍스트 경로를 기반으로 클라이
언트 요청에 응답합니다. MIME 타입 설정과 디렉토리 리스트 생성을 지원하며, 웹 애플리케이션의 정적 리소스 처리에 사용됩니다. 설정 가능하며, 대부분의 Java 웹 애플리케이션 서버에 내장되어 있습니다.

### 생명주기

- servlet-practices > helloweb > servlets > LifeCycleServlet.jsp 추가


![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/d3f7c26c-b610-4633-8d1b-a098f18d8adc)


```java
package servlets;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;


public class LifeCycleServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	@Override
	public void init() throws ServletException {
		System.out.println("init() called");
		super.init();
	}

	@Override
	protected void service(HttpServletRequest arg0, HttpServletResponse arg1) throws ServletException, IOException {
		System.out.println("service(...) called");
		super.service(arg0, arg1);
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	System.out.println("doGet(...) called");
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		System.out.println("doPost(...) called");
		doGet(request, response);
	}

	@Override
	public void destroy() {
		System.out.println("destory() called");
		super.destroy();
	}
}

```

- 결과

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/a1fb7437-106b-4b1a-8702-eb2412b9974d)


![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/a340a5fb-3dac-4927-9046-dbf7b1db695b)

이미지 출처: rlo0



> web.xml

```java
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://java.sun.com/xml/ns/javaee"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	version="2.5">
	<display-name>mysite02</display-name>

	<!-- MainController servlet -->
	<servlet>
		<servlet-name>MainController</servlet-name>
		<servlet-class>com.poscodx.mysite.controller.MainController</servlet-class>
		<init-param>
			<param-name>config</param-name>
			<param-value>/WEB-INF/servlet-context.xml</param-value>
		</init-param>
	</servlet>

	<servlet-mapping>
		<servlet-name>MainController</servlet-name>
		<url-pattern></url-pattern>
	</servlet-mapping>

	<servlet-mapping>
		<servlet-name>MainController</servlet-name>
		<url-pattern>/main</url-pattern>
	</servlet-mapping>

	<!-- UserController servlet -->
	<servlet>
		<description></description>
		<display-name>UserController</display-name>
		<servlet-name>UserController</servlet-name>
		<servlet-class>com.poscodx.mysite.controller.UserController</servlet-class>
	</servlet>

	<servlet-mapping>
		<servlet-name>UserController</servlet-name>
		<url-pattern>/user</url-pattern>
	</servlet-mapping>

	<!-- default files -->
	<welcome-file-list>
		<welcome-file>index.html</welcome-file>
		<welcome-file>index.htm</welcome-file>
		<welcome-file>index.jsp</welcome-file>
		<welcome-file>default.html</welcome-file>
		<welcome-file>default.htm</welcome-file>
		<welcome-file>default.jsp</welcome-file>
	</welcome-file-list>

	<servlet>
		<description></description>
		<display-name>GuestbookController</display-name>
		<servlet-name>GuestbookController</servlet-name>
		<servlet-class>com.poscodx.mysite.controller.GuestbookController</servlet-class>
	</servlet>

	<servlet-mapping>
		<servlet-name>GuestbookController</servlet-name>
		<url-pattern>/guestbook</url-pattern>
	</servlet-mapping>
</web-app>
```

> mainController

```java
package com.poscodx.mysite.controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.poscodx.mysite.web.mvc.main.MainActionFactory;
import com.poscodx.web.mvc.Action;
import com.poscodx.web.mvc.user.UserActionFactory;

public class MainController extends HttpServlet {
	private static final long serialVersionUID = 1L;

	@Override
	public void init() throws ServletException {
		String configPath = getServletConfig().getInitParameter("config");
		System.out.println(configPath);
		super.init();
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("utf-8");

		String actionName = request.getParameter("a");
		Action action = new MainActionFactory().getAction(actionName);
		action.execute(request, response);
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}

}

```


> 결과

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/afb82063-8172-473e-94fd-8a14ec80c3ab)


---

### 관심: concern / 관점: aspect

객체지향이 추구하는 것. 내가 무엇을 할 것인지 금방 알 수 있는 것. 

- 핵심 관심 : MainController의 mainActionFactory... / UserController의 userActionFactory...

- 횡단 관심 : 핵심 관심 앞뒤의 것. 이것이 객체지향을 깬다고 이야기함. 

AOP의 도움을 받아서 더 완벽한 OOP를 만든다. => spring 

Filter도 관심을 위함. (완벽한 OOP) => 컨트롤러 상단의 공통 필터 ex. encoding filter 

************** 관심의 분리 = separation of concern *****************

횡단 관심을 분리해서, 핵심관심만 남게 한다. 


![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/07aa5781-5a45-4b42-a617-55e97ebfcd97)

이미지 출처: rlo0

---

#### 관심 분리를 위한 filter 실습

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/5c5801d0-a45c-4d77-a873-e059fbe4a6cd)


![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/1dd7c23e-c590-4064-abd6-7c77b5f3a02b)


모든 경로

- EncodingFilter.java

```java
package com.poscodx.mysite.web;

import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpFilter;

public class EncodingFilter extends HttpFilter implements Filter {
    private static final long serialVersonUID = 1L;
	
    public EncodingFilter() {
        super();
    }

	public void destroy() {
	}

	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		/* request 처리 */
		request.setCharacterEncoding("utf-8");
		
		chain.doFilter(request, response);
		/* response 처리 */
	}

	public void init(FilterConfig fConfig) throws ServletException {
	}

}

```

- web.xml

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/609206ef-f096-46b6-81f4-2baabd58ef46)



#### 만약에 web.xml에 init을 이용한다면,

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/2d143b94-a3b2-4b75-8944-af59836c8af2)

- EncodingFilter.java

```java
package com.poscodx.mysite.web;

import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpFilter;

public class EncodingFilter extends HttpFilter implements Filter {
    private static final long serialVersonUID = 1L;
	private String encoding;
	
	public void init(FilterConfig fConfig) throws ServletException {
		encoding = fConfig.getInitParameter("encoding");
		
		if(encoding == null) {
			encoding = "utf-8";
		}
	}

	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		/* request 처리 */
		request.setCharacterEncoding(encoding);
		
		chain.doFilter(request, response);
		/* response 처리 */
	}

	public EncodingFilter() {
        super();
    }

	public void destroy() {
	}



}

```


---

### WAS = Servlet Container, Application Context, Servlet Context

- Listener : 로딩될 때, 실행 (서버 시작했을 때...)

ex. 전역에 사용되는 객체가 필요할 때! 

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/30810b5a-29b9-4740-a4d8-913af4a90827)

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/e87c0294-df0f-4bc4-85f9-a2ea7350dfd0)


```java
package com.poscodx.mysite.web;

import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;

public class ContextLoadListner implements ServletContextListener {

	public void contextInitialized(ServletContextEvent sce)  { 
		System.out.println("Application starts.....");
	}

    public void contextDestroyed(ServletContextEvent sce)  { 
    }

	
}

```


- 이러면, web.xml에 자동 추가가 됨.

- 서버 재 실행시,

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/98aed738-910e-4f19-ab75-75b7d994c169)

