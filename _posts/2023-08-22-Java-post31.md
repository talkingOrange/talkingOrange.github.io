---
layout: post
title:  "[í¬ìŠ¤ì½”DX|Java|3ì£¼] 10ì¼ì°¨ ìˆ˜ì—…"
date:   2023-08-22
categories: Java
---

# í¬ìŠ¤ì½”DX X ë¹„íŠ¸êµìœ¡ì„¼í„° 6ê¸° - TCP / ë¹„ë™ê¸° í”„ë¡œê·¸ë¨ / ë¦¬ëˆ…ìŠ¤

--- 

### ë¹„ë™ê¸°ğŸ˜Š

non-blocking -> callback

ì‘ë‹µì´ í¬ê²Œ í•„ìš”ì—†ëŠ” ê²½ìš°, ë¹„ë™ê¸°ë¥¼ ì´ìš©í•œë‹¤.

ìš”ì¦˜ ìœ í–‰ - ë¹„ë™ê¸° (ì•Œë¦¼ê¸°ëŠ¥ ê°€ëŠ¥

ì¹´ì¹´ì˜¤í†¡ - ì›¹ ì†Œì¼“ ê¸°ë°˜ì˜ ë¹„ë™ê¸° ì±„íŒ…

---

ì¸í„°ë„·: í”„ë¡œê·¸ë¨ê³¼ í”„ë¡œê·¸ë¨ì˜ ì—°ê²°
ì†Œí†µë°©ë²• : TCP, UDP

> TCP í†µì‹ 

- íŒ¨í‚· í†µì‹  : ë°ì´í„°ë¥¼ ìª¼ê°¬ìœ¼ë¡œì¨ ë‹¤ì–‘í•œ ê²½ë¡œë¡œ ì—°ê²°ì´ ê°€ëŠ¥í•¨.
- íŠ¹ì§• : 3-way handshake

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/2560a3e8-e63b-4637-bf9e-472e01978957)

- í™•ì¸ ê³¼ì •ì„ í†µí•œ ì‹ ë¢°ì„± (ì‘ë‹µí™•ì¸) + ì‹œí€€ìŠ¤ ë²ˆí˜¸ë¥¼ í†µí•´ ì†Œí†µì´ ë„ˆë¬´ ëŠë¦¬ê±°ë‚˜ ë¹¨ë¼ë„ ì‹œí€€ìŠ¤ë¥¼ í†µí•´ ìˆœì„œëŒ€ë¡œ ì „ë‹¬ì´ ê°€ëŠ¥í•˜ë‹¤.

> í†µì‹  ê³¼ì •

1. ì¸í„°ë„·ì˜ ë°ì´í„°ëŠ” ì†Œì¼“ ë²„í¼ì— ìŒ“ì¸ë‹¤.
2. ë°ì´í„°ë¥¼ ì–¼ë§ˆë§Œí¼ ì½ì–´ì•¼í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.
3. ë°ì´í„° í¬ê¸° ëª…ì‹œ í•„ìš” (\r\n)



---

### TCP êµ¬ì¡°

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/9cecbd74-b89c-4848-b90f-0240c730d1ad)

TCP í—¤ë”ì— ë‹´ê²¨ ìˆëŠ” ì •ë³´ë“¤.

- ì‹ ë¢°ì„±ì´ ìˆë‹¤. : ì •ë³´ë¥¼ ê¼­ ë³´ë‚´ì¤€ë‹¤.
- windowSize : ì‚¬ì´ì¦ˆë¥¼ í†µí•´ ê³µê°„ì´ ìƒê¸°ë©´ streamì„ ê´€ë¦¬í•¨. 

---

### TCP ì—°ê²° 

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/ace08581-fc52-47fc-a220-d7e7d26f78b8)
> TCP/IP = 3way

- ë”°ë¥´ë¦‰ ë”°ë¥´ë¦‰ : synì‹±í¬ ì‹ í˜¸
- ì—¬ë³´ì„¸ìš”(ì „í™”ë°›ì€ì‚¬ëŒ) : synì‹±í¬ + ack
- ì—¬ë³´ì„¸ìš” : ack

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/a42af546-7235-4594-affb-a74bce73c7f7)

---

### TCP ë°ì´í„° ì†¡ìˆ˜ì‹  

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/d4be0557-f04e-45b6-8f58-a6f15acbae68)

-  ACK ë²ˆí˜¸  =  SEQ ë²ˆí˜¸ + ì „ì†¡ëœ ë°”ì´íŠ¸ í¬ê¸° + 1

### TCP ë°ì´í„° ì—°ê²°ì¢…ë£Œ

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/60f0a938-879d-42dc-8ab3-c148456db837)

- ì—°ê²°ì¢…ë£Œì—ì„œëŠ”  ë°”ë¡œ ëš! ëŠì§€ ì•ŠëŠ”ë‹¤.  (ìš°ì•„í•œ ì¢…ë£Œ)
- ìƒëŒ€ë°©ì´ ì „ì†¡í•  ë°ì´í„°ê°€ ë‚¨ì•„ ìˆì„ ì§€ ëª¨ë¥´ë‹ˆ  ìƒí˜¸ê°„ì— ì—°ê²°ì¢…ë£Œì— ëŒ€í•œ í•©ì˜ê³¼ì •ì„ ê±°ì¹œë‹¤.
- íŒ¨í‚· ì•ˆì— FINì€ ì¢…ë£Œë¥¼ ì•Œë¦¬ëŠ” ë©”ì‹œì§€ë¥¼ ëœ»í•œë‹¤.
- ìƒí˜¸ê°„ì— FIN ë©”ì‹œì§€ë¥¼ í•œ ë²ˆì”© ì£¼ê³  ë°›ëŠ”ë‹¤ (4-Way Handshaking)
  - A : B ì•¼, ì´ì œ ì „í™” ëŠì
  - B : ì–´~ ì ì‹œë§Œ ê¸°ë‹¬ë ¤ì£¼ì…ˆ
  - B : ì´ì œ ëë‹¤, ì „í™” ëŠìœ¼ì‚¼
  - A : ëŠì–´ì•¼ì§€
  - TIME-WAIT ì— ë“¤ì–´ê°

---

### TCP ì˜µì…˜

- ë°œìƒ ê°€ëŠ¥í•œ ë¬¸ì œì— ëŒ€ë¹„, í•´ê²°í•˜ê¸° ìœ„í•œ ì˜µì…˜ì´ ìˆë‹¤.

> ì†Œì¼“ ë²„í¼ ì‚¬ì´ì¦ˆ (Client)

```java
// 1. ì†Œì¼“ ìƒì„±
			socket = new Socket();

			// 1-1. ì†Œì¼“ ë²„í¼ ì‚¬ì´ì¦ˆ í™•ì¸
			int rcvBufferSize = socket.getReceiveBufferSize();
			int sndBufferSize = socket.getSendBufferSize();
			
			System.out.println(rcvBufferSize + " : " + sndBufferSize);
			
			// 1-2. ì†Œì¼“ ë²„í¼ ì‚¬ì´ì¦ˆ ë³€ê²½
			socket.setReceiveBufferSize(1024*10);
			socket.setSendBufferSize(1024*10);
			
			rcvBufferSize = socket.getReceiveBufferSize();
			sndBufferSize = socket.getSendBufferSize();
			
			System.out.println(rcvBufferSize + " : " + sndBufferSize);
```

#### Time wait

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/11c9bc17-a051-4ea8-9e97-95464bca2341)

- ë§ˆì§€ë§‰ íŒ¨í‚·ì´ ì œëŒ€ë¡œ ì „ì†¡ì´ ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê²ƒ

> time wait ì—†ì• ê¸° (Server)

```java
//1. Server Socket ìƒì„±
			serverSocket = new ServerSocket();
			
			// 1-1. FIN-WAIT -> TIME_WAIT ìƒíƒœì—ì„œë„ ì†Œì¼“ í¬íŠ¸ í• ë‹¹ì´ ê°€ëŠ¥í•˜ë„ë¡ í•˜ê¸° ìœ„í•´.
			serverSocket.setReuseAddress(true);
```


> ackë¥¼ ë°›ì§€ ì•Šê² ë‹¤. (Client)

```java
//1-3. SO_NODELAY(Nagle Algorithm off)
			socket.setTcpNoDelay(true);
			
```


> ì†Œì¼“ì— ë°ì´í„°ë¥¼ ì“°ê³ /ì½ëŠ” íƒ€ì„ì•„ì›ƒì„ ì •í•œë‹¤. readì—ë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. (Client)

```java
//1-4. SO_TIMEOUT
			socket.setSoTimeout(3000);
			
```

---

### UDP

í•œ ë²ˆ ë³´ë‚´ê³  ëœ». ì—†ì–´ì§€ë©´, ë‹¤ì‹œ ì•ˆ ë³´ëƒ„. ëª°ë¼!

- ë¹„ ì—°ê²° ì§€í–¥
- êµ³ì´ threadë¥¼ ë§Œë“¤ì§€ ì•Šì•„ë„ ë‹¤ì¤‘ ì§€ì›
- ì†ë„ê°€ ë¹ ë¦„

```java
package udp;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.SocketException;

public class UdpEchoServer {
	public static final int PORT = 8000;
	public static final int BUFFER_SIZE = 256;

	public static void main(String[] args) {
		DatagramSocket socket = null;
		try {
			//1. ì†Œì¼“ ìƒì„±
			socket = new DatagramSocket(PORT);
			
			while(true) {
				//2. ë°ì´í„° ìˆ˜ì‹ 
				DatagramPacket rcvPacket = new DatagramPacket(new byte[BUFFER_SIZE], BUFFER_SIZE );
				socket.receive(rcvPacket); // Blocking
				
				byte[] rcvData = rcvPacket.getData();
				int offset = rcvPacket.getLength();
				
				String message = new String(rcvData, 0 , offset, "utf-8");
				
				System.out.println("[UDP Echo Server] received:" + message);
				
				//3.ì†¡ì‹ 
				byte[] sndData = message.getBytes("utf-8");
				DatagramPacket sndPacket = new DatagramPacket(sndData, sndData.length, rcvPacket.getAddress(), rcvPacket.getPort());
				
				socket.send(sndPacket);
			}
		} catch (SocketException e) {
			System.out.println("[UDP Echo Server] error:" + e);
		} catch (IOException e) {
			System.out.println("[UDP Echo Server] error:" + e);
		} finally {
			if (socket != null && socket.isClosed()) {
				socket.close();
			}
		}
	}
}

```

```java
package udp;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.SocketException;
import java.util.Scanner;

import echo.EchoServer;

public class UdpEchoClient {
	private static final String SERVER_IP = "127.0.0.1";

	public static void main(String[] args) {
		DatagramSocket socket = null;
		Scanner scanner = null;
		
		try {
			//1. ìŠ¤ìºë„ˆ ìƒì„±
			scanner = new Scanner(System.in);
			
			//2. ì†Œì¼“ ìƒì„±
			socket = new DatagramSocket();
			while(true) {
				System.out.print(">");
				String line = scanner.nextLine();
				
				if("exit".equals(line)) {
					break;
				}
				
				//3. ë³´ë‚´ê¸°
				byte[] sndData = line.getBytes("utf-8");
				DatagramPacket sndPacket = new DatagramPacket(sndData, sndData.length, new InetSocketAddress(SERVER_IP, UdpEchoServer.PORT));
				
				socket.send(sndPacket);
				
				//4. ë°›ì•„ì„œ ì½ê¸°
				DatagramPacket rcvPacket = new DatagramPacket(new byte[UdpEchoServer.BUFFER_SIZE], UdpEchoServer.BUFFER_SIZE );
				socket.receive(rcvPacket); // Blocking
				
				byte[] rcvData = rcvPacket.getData();
				int offset = rcvPacket.getLength();
				
				String message = new String(rcvData, 0 , offset, "utf-8");
				
				System.out.println("<" + message);
				
			}
		} catch (SocketException e) {
			System.out.println("[UDP Echo client] error:" + e);
		} catch (IOException e) {
			System.out.println("[UDP Echo client] error:" + e);
		} finally {
			if(scanner != null) {
				scanner.close();
			}
			if (socket != null && socket.isClosed()) {
				socket.close();
			}
		}
	}
	
	private static void log(String message) {
		System.out.println("[EchoClient] " + message);
	}	
}

```


---

### Window Chatting Program

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/6caab93a-b647-4510-803f-02f9e3e76422)


---

### ë¦¬ëˆ…ìŠ¤


- redhat -> RHEL , CentOs12(x) -> Rocky
- debian -> ubuntu


![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/bef8a930-8fb6-49ee-878d-a96fbb6bc5a3)

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/49a0f21d-b94e-4570-8dd2-3ca2cc5ef22e)

ì–´ëŒ‘í„°ì— ë¸Œë¦¬ì§€ë¡œ í•˜ëŠ” ì´ìœ  :  ë‚´ë¶€ NATë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë°”ë¡œ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§„ë‹¤.

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/32b189eb-90d9-442f-9abd-896d8396af3b)
 
