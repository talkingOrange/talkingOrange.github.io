---
layout: post
title:  "[Ìè¨Ïä§ÏΩîDX|Java|3Ï£º] 10ÏùºÏ∞® ÏàòÏóÖ"
date:   2023-08-22
categories: Java
---

# Ìè¨Ïä§ÏΩîDX X ÎπÑÌä∏ÍµêÏú°ÏÑºÌÑ∞ 6Í∏∞ - TCP / ÎπÑÎèôÍ∏∞ ÌîÑÎ°úÍ∑∏Îû® / Î¶¨ÎàÖÏä§Ïä§

--- 

### ÎπÑÎèôÍ∏∞üòä

non-blocking -> callback

ÏùëÎãµÏù¥ ÌÅ¨Í≤å ÌïÑÏöîÏóÜÎäî Í≤ΩÏö∞, ÎπÑÎèôÍ∏∞Î•º Ïù¥Ïö©ÌïúÎã§.

ÏöîÏ¶ò Ïú†Ìñâ - ÎπÑÎèôÍ∏∞ (ÏïåÎ¶ºÍ∏∞Îä• Í∞ÄÎä•

Ïπ¥Ïπ¥Ïò§ÌÜ° - Ïõπ ÏÜåÏºì Í∏∞Î∞òÏùò ÎπÑÎèôÍ∏∞ Ï±ÑÌåÖ

---

Ïù∏ÌÑ∞ÎÑ∑: ÌîÑÎ°úÍ∑∏Îû®Í≥º ÌîÑÎ°úÍ∑∏Îû®Ïùò Ïó∞Í≤∞
ÏÜåÌÜµÎ∞©Î≤ï : TCP, UDP

> TCP ÌÜµÏã†

- Ìå®ÌÇ∑ ÌÜµÏã† : Îç∞Ïù¥ÌÑ∞Î•º Ï™ºÍ∞¨ÏúºÎ°úÏç® Îã§ÏñëÌïú Í≤ΩÎ°úÎ°ú Ïó∞Í≤∞Ïù¥ Í∞ÄÎä•Ìï®.
- ÌäπÏßï : 3-way handshake

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/2560a3e8-e63b-4637-bf9e-472e01978957)

- ÌôïÏù∏ Í≥ºÏ†ïÏùÑ ÌÜµÌïú Ïã†Î¢∞ÏÑ± (ÏùëÎãµÌôïÏù∏) + ÏãúÌÄÄÏä§ Î≤àÌò∏Î•º ÌÜµÌï¥ ÏÜåÌÜµÏù¥ ÎÑàÎ¨¥ ÎäêÎ¶¨Í±∞ÎÇò Îπ®ÎùºÎèÑ ÏãúÌÄÄÏä§Î•º ÌÜµÌï¥ ÏàúÏÑúÎåÄÎ°ú Ï†ÑÎã¨Ïù¥ Í∞ÄÎä•ÌïòÎã§.

> ÌÜµÏã† Í≥ºÏ†ï

1. Ïù∏ÌÑ∞ÎÑ∑Ïùò Îç∞Ïù¥ÌÑ∞Îäî ÏÜåÏºì Î≤ÑÌçºÏóê ÏåìÏù∏Îã§.
2. Îç∞Ïù¥ÌÑ∞Î•º ÏñºÎßàÎßåÌÅº ÏùΩÏñ¥ÏïºÌïòÎäîÏßÄ Ïïå Ïàò ÏóÜÎã§.
3. Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞ Î™ÖÏãú ÌïÑÏöî (\r\n)



---

### TCP Íµ¨Ï°∞

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/9cecbd74-b89c-4848-b90f-0240c730d1ad)

TCP Ìó§ÎçîÏóê Îã¥Í≤® ÏûàÎäî Ï†ïÎ≥¥Îì§.

- Ïã†Î¢∞ÏÑ±Ïù¥ ÏûàÎã§. : Ï†ïÎ≥¥Î•º Íº≠ Î≥¥ÎÇ¥Ï§ÄÎã§.
- windowSize : ÏÇ¨Ïù¥Ï¶àÎ•º ÌÜµÌï¥ Í≥µÍ∞ÑÏù¥ ÏÉùÍ∏∞Î©¥ streamÏùÑ Í¥ÄÎ¶¨Ìï®. 

---

### TCP Ïó∞Í≤∞ 

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/ace08581-fc52-47fc-a220-d7e7d26f78b8)
> TCP/IP = 3way

- Îî∞Î•¥Î¶â Îî∞Î•¥Î¶â : synÏã±ÌÅ¨ Ïã†Ìò∏
- Ïó¨Î≥¥ÏÑ∏Ïöî(Ï†ÑÌôîÎ∞õÏùÄÏÇ¨Îûå) : synÏã±ÌÅ¨ + ack
- Ïó¨Î≥¥ÏÑ∏Ïöî : ack

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/a42af546-7235-4594-affb-a74bce73c7f7)

---

### TCP Îç∞Ïù¥ÌÑ∞ ÏÜ°ÏàòÏã† 

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/d4be0557-f04e-45b6-8f58-a6f15acbae68)

-  ACK Î≤àÌò∏  =  SEQ Î≤àÌò∏ + Ï†ÑÏÜ°Îêú Î∞îÏù¥Ìä∏ ÌÅ¨Í∏∞ + 1

### TCP Îç∞Ïù¥ÌÑ∞ Ïó∞Í≤∞Ï¢ÖÎ£å

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/60f0a938-879d-42dc-8ab3-c148456db837)

- Ïó∞Í≤∞Ï¢ÖÎ£åÏóêÏÑúÎäî  Î∞îÎ°ú Îöù! ÎÅäÏßÄ ÏïäÎäîÎã§.  (Ïö∞ÏïÑÌïú Ï¢ÖÎ£å)
- ÏÉÅÎåÄÎ∞©Ïù¥ Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÎÇ®ÏïÑ ÏûàÏùÑ ÏßÄ Î™®Î•¥Îãà  ÏÉÅÌò∏Í∞ÑÏóê Ïó∞Í≤∞Ï¢ÖÎ£åÏóê ÎåÄÌïú Ìï©ÏùòÍ≥ºÏ†ïÏùÑ Í±∞ÏπúÎã§.
- Ìå®ÌÇ∑ ÏïàÏóê FINÏùÄ Ï¢ÖÎ£åÎ•º ÏïåÎ¶¨Îäî Î©îÏãúÏßÄÎ•º ÎúªÌïúÎã§.
- ÏÉÅÌò∏Í∞ÑÏóê FIN Î©îÏãúÏßÄÎ•º Ìïú Î≤àÏî© Ï£ºÍ≥† Î∞õÎäîÎã§ (4-Way Handshaking)
  - A : B Ïïº, Ïù¥Ï†ú Ï†ÑÌôî ÎÅäÏûê
  - B : Ïñ¥~ Ïû†ÏãúÎßå Í∏∞Îã¨Î†§Ï£ºÏÖà
  - B : Ïù¥Ï†ú ÎêêÎã§, Ï†ÑÌôî ÎÅäÏúºÏÇº
  - A : ÎÅäÏñ¥ÏïºÏßÄ
  - TIME-WAIT Ïóê Îì§Ïñ¥Í∞ê

---

### TCP ÏòµÏÖò

- Î∞úÏÉù Í∞ÄÎä•Ìïú Î¨∏Ï†úÏóê ÎåÄÎπÑ, Ìï¥Í≤∞ÌïòÍ∏∞ ÏúÑÌïú ÏòµÏÖòÏù¥ ÏûàÎã§.

> ÏÜåÏºì Î≤ÑÌçº ÏÇ¨Ïù¥Ï¶à (Client)

```java
// 1. ÏÜåÏºì ÏÉùÏÑ±
			socket = new Socket();

			// 1-1. ÏÜåÏºì Î≤ÑÌçº ÏÇ¨Ïù¥Ï¶à ÌôïÏù∏
			int rcvBufferSize = socket.getReceiveBufferSize();
			int sndBufferSize = socket.getSendBufferSize();
			
			System.out.println(rcvBufferSize + " : " + sndBufferSize);
			
			// 1-2. ÏÜåÏºì Î≤ÑÌçº ÏÇ¨Ïù¥Ï¶à Î≥ÄÍ≤Ω
			socket.setReceiveBufferSize(1024*10);
			socket.setSendBufferSize(1024*10);
			
			rcvBufferSize = socket.getReceiveBufferSize();
			sndBufferSize = socket.getSendBufferSize();
			
			System.out.println(rcvBufferSize + " : " + sndBufferSize);
```

#### Time wait

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/11c9bc17-a051-4ea8-9e97-95464bca2341)

- ÎßàÏßÄÎßâ Ìå®ÌÇ∑Ïù¥ Ï†úÎåÄÎ°ú Ï†ÑÏÜ°Ïù¥ ÎêòÏóàÎäîÏßÄÎ•º ÌôïÏù∏ÌïòÍ∏∞ ÏúÑÌï¥ ÌïÑÏöîÌïú Í≤É

> time wait ÏóÜÏï†Í∏∞ (Server)

```java
//1. Server Socket ÏÉùÏÑ±
			serverSocket = new ServerSocket();
			
			// 1-1. FIN-WAIT -> TIME_WAIT ÏÉÅÌÉúÏóêÏÑúÎèÑ ÏÜåÏºì Ìè¨Ìä∏ Ìï†ÎãπÏù¥ Í∞ÄÎä•ÌïòÎèÑÎ°ù ÌïòÍ∏∞ ÏúÑÌï¥.
			serverSocket.setReuseAddress(true);
```


> ackÎ•º Î∞õÏßÄ ÏïäÍ≤†Îã§. (Client)

```java
//1-3. SO_NODELAY(Nagle Algorithm off)
			socket.setTcpNoDelay(true);
			
```


> ÏÜåÏºìÏóê Îç∞Ïù¥ÌÑ∞Î•º Ïì∞Í≥†/ÏùΩÎäî ÌÉÄÏûÑÏïÑÏõÉÏùÑ Ï†ïÌïúÎã§. readÏóêÎßå ÏÇ¨Ïö©Ïù¥ Í∞ÄÎä•ÌïòÎã§. (Client)

```java
//1-4. SO_TIMEOUT
			socket.setSoTimeout(3000);
			
```

---

### UDP

Ìïú Î≤à Î≥¥ÎÇ¥Í≥† Îúª. ÏóÜÏñ¥ÏßÄÎ©¥, Îã§Ïãú Ïïà Î≥¥ÎÉÑ. Î™∞Îùº!

- ÎπÑ Ïó∞Í≤∞ ÏßÄÌñ•
- Íµ≥Ïù¥ threadÎ•º ÎßåÎì§ÏßÄ ÏïäÏïÑÎèÑ Îã§Ï§ë ÏßÄÏõê
- ÏÜçÎèÑÍ∞Ä Îπ†Î¶Ñ

```java
package udp;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.SocketException;

public class UdpEchoServer {
	public static final int PORT = 8000;
	public static final int BUFFER_SIZE = 256;

	public static void main(String[] args) {
		DatagramSocket socket = null;
		try {
			//1. ÏÜåÏºì ÏÉùÏÑ±
			socket = new DatagramSocket(PORT);
			
			while(true) {
				//2. Îç∞Ïù¥ÌÑ∞ ÏàòÏã†
				DatagramPacket rcvPacket = new DatagramPacket(new byte[BUFFER_SIZE], BUFFER_SIZE );
				socket.receive(rcvPacket); // Blocking
				
				byte[] rcvData = rcvPacket.getData();
				int offset = rcvPacket.getLength();
				
				String message = new String(rcvData, 0 , offset, "utf-8");
				
				System.out.println("[UDP Echo Server] received:" + message);
				
				//3.ÏÜ°Ïã†
				byte[] sndData = message.getBytes("utf-8");
				DatagramPacket sndPacket = new DatagramPacket(sndData, sndData.length, rcvPacket.getAddress(), rcvPacket.getPort());
				
				socket.send(sndPacket);
			}
		} catch (SocketException e) {
			System.out.println("[UDP Echo Server] error:" + e);
		} catch (IOException e) {
			System.out.println("[UDP Echo Server] error:" + e);
		} finally {
			if (socket != null && socket.isClosed()) {
				socket.close();
			}
		}
	}
}

```

```java
package udp;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.SocketException;
import java.util.Scanner;

import echo.EchoServer;

public class UdpEchoClient {
	private static final String SERVER_IP = "127.0.0.1";

	public static void main(String[] args) {
		DatagramSocket socket = null;
		Scanner scanner = null;
		
		try {
			//1. Ïä§Ï∫êÎÑà ÏÉùÏÑ±
			scanner = new Scanner(System.in);
			
			//2. ÏÜåÏºì ÏÉùÏÑ±
			socket = new DatagramSocket();
			while(true) {
				System.out.print(">");
				String line = scanner.nextLine();
				
				if("exit".equals(line)) {
					break;
				}
				
				//3. Î≥¥ÎÇ¥Í∏∞
				byte[] sndData = line.getBytes("utf-8");
				DatagramPacket sndPacket = new DatagramPacket(sndData, sndData.length, new InetSocketAddress(SERVER_IP, UdpEchoServer.PORT));
				
				socket.send(sndPacket);
				
				//4. Î∞õÏïÑÏÑú ÏùΩÍ∏∞
				DatagramPacket rcvPacket = new DatagramPacket(new byte[UdpEchoServer.BUFFER_SIZE], UdpEchoServer.BUFFER_SIZE );
				socket.receive(rcvPacket); // Blocking
				
				byte[] rcvData = rcvPacket.getData();
				int offset = rcvPacket.getLength();
				
				String message = new String(rcvData, 0 , offset, "utf-8");
				
				System.out.println("<" + message);
				
			}
		} catch (SocketException e) {
			System.out.println("[UDP Echo client] error:" + e);
		} catch (IOException e) {
			System.out.println("[UDP Echo client] error:" + e);
		} finally {
			if(scanner != null) {
				scanner.close();
			}
			if (socket != null && socket.isClosed()) {
				socket.close();
			}
		}
	}
	
	private static void log(String message) {
		System.out.println("[EchoClient] " + message);
	}	
}

```


---

### Window Chatting Program

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/6caab93a-b647-4510-803f-02f9e3e76422)


---

### Î¶¨ÎàÖÏä§


- redhat -> RHEL , CentOs12(x) -> Rocky
- debian -> ubuntu


