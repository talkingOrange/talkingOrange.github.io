---
layout: post
title:  "[포스코DX|ReactJS|14주] 61일차 수업, build & deploy"
date:   2023-11-09
categories: Java
---

# 포스코DX X 비트교육센터 6기 - build & deploy

---

### backend에 mojo 플러그인 설치

- pom.xml

```java

<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>exec-maven-plugin</artifactId>
				<version>3.0.0</version>
				<executions>
					<execution>
						<goals>
							<goal>exec</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<executable>npm</executable>
					<workingDirectory>../frontend</workingDirectory>
					<arguments>
						<argument>run</argument>
						<argument>build:fe</argument>
					</arguments>
					<environmentVariables>
					</environmentVariables>
				</configuration>
			</plugin>
```


- exec-maven-plugin은 Maven 빌드 중에 외부 명령어나 스크립트를 실행하기 위한 플러그인 중 하나
- 이 플러그인을 사용하면 Maven 빌드 프로세스 중에 정의된 명령어나 스크립트를 실행하여 원하는 작업을 수행할 수 있다.

- 여기서는 npm이라는 Node.js 패키지 매니저를 실행하고, 해당 명령어의 실행 위치를 ../frontend로 지정하고 있어요. 그리고 npm run build:fe라는 스크립트를 실행 중.
- 이렇게 함으로써 Maven 빌드 중에 프론트엔드 자원을 빌드하는 등의 작업을 수행

- mojo란 이름은 Maven에서 사용하는 플러그인을 만들 때 자주 사용되는 용어이며, Maven의 플러그인 아키텍처를 구성하는 구성 요소 중 하나
- 따라서 org.codehaus.mojo는 Maven 플러그인을 위한 코드를 제공하는 Maven의 프로젝트 중 하나


### frontend에 build script 추가하기

```
"build:fe": "npm install && npx webpack --config config/webpack.config.js --mode production",
```

- npm install은 Node.js 프로젝트에서 사용되는 패키지 의존성을 설치하는 명령어
- 여기서 "build:fe"이라는 스크립트를 실행하기 전에 npm install 명령어를 사용하면, 프로젝트에 필요한 패키지들이 설치되어 있지 않다면 먼저 필요한 패키지들을 설치

### backend에 애플리케이션 실행 설정 정의 수정

```
# spring configuration
spring:
   application:
      name: emaillist
   profiles:
      active: development
      
      
---
# common spring boot configuration
spring:
   mvc:
      static-path-pattern: /assets/**
      throw-exception-if-no-handler-found: true
   web:
      resources:
         static-locations: classpath:/assets/

   thymeleaf:
      prefix : classpath:templates/
      check-template-location: true
      mode: HTML5
      suffix : .html
      cache : false

mybatis:
   config-location: classpath:mybatis/configuration.xml

logging:
   pattern:
      console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{5} - %msg%n"
   level:
      root: INFO



---
# development profile: spring boot configuration
spring:
   config:
      activate:
         on-profile: development

   devtools:
      livereload:
         enabled: true
                     
   datasource:
      driver-class-name: org.mariadb.jdbc.Driver
      url: jdbc:mariadb://[내 ip주소]:3307/webdb?charset=utf8
      username: webdb
      password: webdb
      hikari:
         minimum-idle: 10
         maximum-pool-size: 20
   
server:
   port: 8080
   servlet:
      context-path: /
      encoding:
         charset: utf-8
         enabled: true
         


---
# production profile: spring boot configuration
spring:
   config:
      activate:
         on-profile: production

   datasource:
      driver-class-name: org.mariadb.jdbc.Driver
      url: jdbc:mariadb://[내 ip주소]:3307/webdb?charset=utf8
      username: webdb
      password: webdb
      hikari:
         minimum-idle: 10
         maximum-pool-size: 20
         
server:
   port: 8088
   servlet:
      context-path: /
      encoding:
         charset: UTF-8
         enabled: true
```



- 터미널에서 해당 명령어로 build success 확인하기.

```
C:\Users\pc\Desktop\poscodx2023\eclipse\react-practices\emaillist\backend> mvn exec:exec clean package
```

- centOS에서 build 해보기

```
// git에서 프로젝트 clone 받기
 # git clone 주소

// 만약에, 프로젝트 내용이 바뀐다면, git push하고, centOS에 있는 프로젝트를 삭제하고 다시 clone 받기
 # rm -rf [프로젝트 이름]
 # git clone 주소


// 빌드(배포)
 # mvn -f emaillist/backend exec:exec clean package

// 테스트
 # java -Dspring.profiles.active=production -jar emaillist/backend/target/emaillist.jar
```



![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/49eabd8c-80fa-4bcf-9b16-0f1e4352abf0)


## Jenkins 배포하기

- 새로운 Items 추가
- Freestyle Project로 ok

- ![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/2958ad3c-ed28-4961-aa6a-e645a7f9db57)

- ![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/db772471-677b-4dc8-92eb-220c1b2b4039)

- build 하기


- 결과 )

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/2b454452-1a6f-490c-adb9-f7304115d66c)


## SSH 연결하기

- SSH란?

: 인증 및 접근 제어; SSH 키 기반의 인증은 안전하면서도 편리한 방법으로 접근을 제어할 수 있습니다. 특히 배포나 서버 접속과 같은 작업에서는 SSH 키를 사용하는 것이 일반적입니다. SSH 키는 비밀번호와는 달리 보안성이 높아, 무단 접근을 방지하는 데 도움이 됩니다.

SSH 키는 보안성을 높이고, 사용자 경험을 향상시키며, 자동화와 관리의 용이성을 제공하여 서버 접속 및 배포와 같은 작업을 더 효과적으로 수행할 수 있도록 도와줍니다.

- CentOS에서 key 생성하기

```
    # ssh-keygen -t rsa -b 2048 -m PEM -C "sonrisa-bonita@naver.com"
```

- key 생성 확인 (root에서 cd .ssh으로 가서 ll 하면 두가지의 키를 확인할 수 있다.)
    
```
# cd .ssh
# ll

    - private key(개인키): ~/.ssh/id_rsa
    - public key(공개키): ~/.ssh/id_rsa.pub
```

- 공개키를 서버에 설치하기

```
     # mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
```

- private key 잘 저장하기

```
     # cat id_rsa
```

나오는 키값을 메모장에 옮겨 적고

모든 파일로 로컬에 'mykey_pem'라는 이름으로 저장
    

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/654985a1-6545-437a-9591-a874f1228cd4)

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/bb80386b-7964-4473-8a4c-7792019e6d33)


> 만약 open이 되지 않는다면??

```
//webmaster password 로 들어가서 root로 들어갈 수 있도록 설정을 바꾸어야함.

# vi /etc/ssh/sshd_config

//PermitRootLogin yes > 저장하기

# systemctl restart sshd
# exit
# open
// 상단 설정 다시해서 들어가기 
```

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/817c42e9-057d-4512-b11a-2d65f2bd30ee)


- deploy: Publish Over SSH 플러그인(Jenkins)

플러그인 다운로드 받기

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/7604fd23-eb8d-401d-a292-ec7108abdfb2)


잰킨스관리의 system에서 다음과 같은 메뉴가 생긴다면 준비 완료

![image](https://github.com/talkingOrange/talkingOrange.github.io/assets/88815795/bb8555f0-3988-4014-a689-093dbbaa0b2d)

